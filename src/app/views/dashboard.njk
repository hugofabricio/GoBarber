{% extends "_layouts/default.njk" %}

{% block body %}
<div class="content">
  <strong>Ol√°, {{ user.name }}</strong>

  {% if user.provider === false %}
  <p>Inicie um agendamento escolhendo um profissional abaixo:</p>
  <ul class="providers">
    {% for provider in providers %}
    <li class="provider">
      <div>
        <img src="/files/{{ provider.avatar }}" alt="Avatar">
        <strong>{{ provider.name }}</strong>
      </div>
      <a href="/app/appointments/new/{{ provider.id }}" title="Agendar">+</a>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p>Lista de agendamentos para o dia:</p>
  <input type="text" class="flatpickr" placeholder="Escolha uma data">
  <ul id="schedules" class="providers"></ul>
  {% endif %}

  <a href="/app/logout" class="logout" title="Sair">Sair</a>
</div>

{% if user.provider === true %}
<script type="text/javascript">
  flatpickr('.flatpickr', {
    minDate: new Date(),
    dateFormat: 'd/m/Y',
    locale: "pt",
    onChange: function (date) {
      fetch(`/app/schedules?date=${date[0].getTime()}`).then(function(response) {
        response.text().then(function (html) {
          document.getElementById('schedules').innerHTML = html;
        })
      })
    }
  });
</script>
{% endif %}
{% endblock %}
